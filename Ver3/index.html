<!DOCTYPE html>
<html>

<head>
	<title>Circle World</title>
	<meta http-equiv="Content-Type" content="text/html; charset = utf-8" />
	<link rel="shortcut icon" href=""> <!-- removed favicon.ico -->
	<link rel="manifest" href="manifest.json">

	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="pragma" content="no-cache" />

	<!-- Add to home screen for Safari on iOS -->
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="#FFC61D">
	<meta name="apple-mobile-web-app-title" content="CwS">

	<link rel="apple-touch-icon" href="icons/icon-152x152.png">

	<!-- Windows -->
	<meta name="msapplication-TileImage" content="icons/icon-144x144.png">
	<meta name="msapplication-TileColor" content="#2F3BA2">

	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#FFC61D">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#FFC61D">

	<link rel="icon" type="image/png" href="icons/icon-144x144.png">

	<style>
		body {
			width: 100%;
			height: 100%;
			overflow: hidden;
			display: block;
		}
	</style>
	
	<script src="js/easeljs.min.js"></script>
	<script src="js/jquery-3.4.1.min.js"></script>

	<script src="js/helpers/util.js"></script>
	<script src="js/helpers/constants.js"></script>
	<script src="js/helpers/graphicsService.js"></script>

	<script src="js/kid.js"></script>
	<script src="js/helpers/builder.js"></script>
	<script src="js/helpers/kidsBuilder.js"></script>
	<script src="js/helpers/physicsHandler.js"></script>

	<script src="js/worldRender.js"></script>

	<!--
	// CreateJS / easelJS Referenece Doc: http://www.createjs.com/getting-started
	//		Google Doc:	https://docs.google.com/document/d/11620kT9Nmc5_p4mYg3t4ClwXM5KSLKS2xj474nmeRqs/edit?ts=5ff9203f
	// Classes:
	//	- CanvasStage Class - Main Stage Class, Starting point
	//  - Kids Class 		- Kids object...
	//	- KidsBuilder Class - Builder class for Kids Object
	//	- Builder Class 	- Util For Attribtue & Location generator class
	//	- PhysicsHandler	- Class to manage physical related decision/detection -- collision with something..  detect bounds..
	//						- Based on each object location..
	-->

</head>

<body>
	<canvas id="demoCanvas" style="background-color: #FDD; margin: 0px; vertical-align: middle; text-align: top;"></canvas>

	<div id="commands" style="margin: 3px;">
		<!--button id="btnStartStop">Stop</button> 
    <button id="btnAddKid" style="margin-left: 7px;">Add Kid</button-->
		<button id="btnReload">Reload App</button>
		<input id="inputFramerate" readonly style="margin-left: 7px; width: 20px; background-color: #eee;" />
		<button id="btnFramerateUp" style="margin-left: 3px;">+</button>
		<button id="btnFramerateDown">-</button>
		<span id="divInfo" style="border: 1px solid #bbbbbb; margin: 5px;"></span>
	</div>
	<div id="divMsg" style="border: 1px solid #bbbbbb;"></div>

	<script>

		var OFFSET_WIDTH = 10;
		var OFFSET_HEIGHT = 40;
		
		// Service Worker Start When Browser Opens/Refreshes..
		serviceWorkerStart();

		// When all the HTML is finished loading, start the JQuery Commands.
		$(document).ready(function () 
		{
			var canvasTag = $( '#demoCanvas');
			var winTag = $( window );

			// 1. Setup Reload Button
			$( '#btnReload' ).click( () => { window.location.reload(); });

			// 2. Set the canvas size to fit width/height of browser
			fitCanvas( canvasTag, winTag );

			// 3. Start the app stage.
			var _canvasStage = new WorldRender( $( window ).width(), $( window ).height() );
			_canvasStage.startUp();

			
			// Resize will be an headache - since we need to restart the stage with diff value?
			//$( window ).on( "resize", function() {  fitCanvas( canvasTag, winTag );  });
		});

		
		function fitCanvas( canvasTag, winTag ) 
		{
			var cTag = canvasTag[0];
			cTag.width = winTag.width() - OFFSET_WIDTH;
			cTag.height = winTag.height() - OFFSET_HEIGHT;

			console.log( 'canvasTag Dimension: ' + canvasTag.width() + ', ' + canvasTag.height());
		}

		// ============================================
		// Size of browser viewport --> $(window).height(); $(window).width();
		// Size of HTML document --> $(document).height(); $(document).width();
		// For screen size (screen obj): --> window.screen.height; window.screen.width;



		// TODO: Improve below ServiceWorker Update Process
		function serviceWorkerStart() 
		{
			// lazy way of disabling service workers while developing
			if ('serviceWorker' in navigator ) //&& ['localhost', '127'].indexOf(location.hostname) === -1
			{
				// register service worker file
				navigator.serviceWorker.register('service-worker.js')
				.then(reg => {
					reg.onupdatefound = () => {
						const installingWorker = reg.installing;
						installingWorker.onstatechange = () => {
							switch (installingWorker.state) {
								case 'installed':
									if (navigator.serviceWorker.controller) {
										// new update available
										console.log( 'Update Found.' );
										//resolve(true);
									} else {
										// no update available
										console.log( 'No Update Found.' );
										//resolve(false);
									}
									break;
							}
						};
					};
				})
				.catch(err => console.error('[SW ERROR]', err));
			}	
		};		

	</script>

</body>

</html>